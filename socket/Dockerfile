# 부모 이미지 지정
FROM node:alpine
# app 디렉토리 생성

WORKDIR /app

COPY package.json .
COPY yarn.lock .

# 패키지 설치
RUN  yarn install

COPY . .
ADD     . /app

# ARG로 빌드 시점 변수를 선언
ARG DATABASE_URL
ARG PORT
ARG DATABASE_HOST
ARG DATABASE_PORT
ARG DATABASE_NAME
ARG DATABASE_USERNAME
ARG DATABASE_PASSWORD
ARG JWT_SECRET
ARG S3_ACCESS_KEY
ARG S3_SECRET_ACCESS_KEY
ARG PASS
ARG USER
ARG GOOGLE_ID
ARG GOOGLE_SECRET
ARG REDIS_HOST
ARG REDIS_PORT
ARG REDIS_PASSWORD

ENV DATABASE_URL=$DATABASE_URL 
ENV PORT=$PORT 
ENV DATABASE_HOST=$DATABASE_HOST 
ENV DATABASE_PORT=$DATABASE_PORT 
ENV DATABASE_NAME=$DATABASE_NAME 
ENV DATABASE_USERNAME=$DATABASE_USERNAME 
ENV DATABASE_PASSWORD=$DATABASE_PASSWORD 
ENV S3_ACCESS_KEY=$S3_ACCESS_KEY 
ENV S3_SECRET_ACCESS_KEY=$S3_SECRET_ACCESS_KEY 
ENV PASS=$PASS 
ENV USER=$USER 
ENV GOOGLE_ID=$GOOGLE_ID 
ENV GOOGLE_SECRET=$GOOGLE_SECRET 
ENV REDIS_HOST=$REDIS_HOST 
ENV REDIS_PORT=$REDIS_PORT 
ENV REDIS_PASSWORD=$REDIS_PASSWORD
ENV JWT_SECRET=$JWT_SECRET

LABEL creator="no6_socket@trello"
LABEL version="1.0.0"




RUN yarn prisma generate
EXPOSE 4000
CMD [ "node", "src/app.js" ]